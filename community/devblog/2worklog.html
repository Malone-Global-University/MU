<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Worklog</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #131a2a;
      --text: #e8eefc;
      --muted: #9fb0d3;
      --accent: #4ea1ff;
      --accent-2: #6affc1;
      --row: #0f1525;
      --row-alt: #11192b;
      --border: #233150;
      --badge-open: #ffd166;
      --badge-progress: #4ea1ff;
      --badge-done: #6affc1;
      --badge-blocked: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f6f8ff;
        --panel: #ffffff;
        --text: #0f172a;
        --muted: #64748b;
        --accent: #0b72ff;
        --accent-2: #0dbd73;
        --row: #ffffff;
        --row-alt: #f8faff;
        --border: #e6eaf3;
        --shadow: 0 6px 18px rgba(2,8,23,.08);
      }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font: 15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 80% -10%, rgba(78,161,255,.12), transparent 70%),
                  radial-gradient(1000px 500px at -10% 10%, rgba(106,255,193,.1), transparent 70%),
                  var(--bg);
      color: var(--text);
    }

    .wrap {
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 20px 40px;
    }

    header.appbar {
      position: sticky;
      top: 0;
      z-index: 5;
      background: linear-gradient(0deg, rgba(0,0,0,0), rgba(0,0,0,.05)), var(--bg);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--border);
    }
    .bar {
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 20px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 12px;
      align-items: center;
    }

    h1 { font-size: 22px; margin: 0; letter-spacing: .2px; }
    .muted { color: var(--muted); font-weight: 500; }

    .controls { display: flex; gap: 10px; align-items: center; }

    .search {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 8px 12px;
      box-shadow: var(--shadow);
    }
    .search input {
      border: 0; outline: 0; background: transparent; color: var(--text);
      min-width: 220px; font-size: 14px;
    }

    .btn {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.05)), var(--panel);
      color: var(--text);
      padding: 10px 14px; border-radius: 12px;
      cursor: pointer; font-weight: 600; letter-spacing: .2px;
      box-shadow: var(--shadow);
    }
    .btn:hover { transform: translateY(-1px); }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: separate; border-spacing: 0;
      background: transparent;
    }
    thead th {
      position: sticky; top: 56px; z-index: 2;
      background: var(--panel);
      text-align: left; font-size: 13px; text-transform: uppercase; letter-spacing: .12em; color: var(--muted);
      border-bottom: 1px solid var(--border);
      padding: 12px 14px;
      user-select: none; cursor: pointer;
    }
    tbody tr { transition: background .15s ease; }
    tbody tr:hover { background: rgba(78,161,255,.08); }
    td {
      padding: 14px; border-bottom: 1px solid var(--border);
      vertical-align: middle; background-clip: padding-box;
    }
    tbody tr:nth-child(even) td { background: linear-gradient(0deg, transparent, transparent), var(--row-alt); }
    tbody tr:nth-child(odd) td { background: linear-gradient(0deg, transparent, transparent), var(--row); }

    .idcell { font-variant-numeric: tabular-nums; width: 90px; color: var(--muted); }
    .titlecell a { color: var(--accent); font-weight: 600; text-decoration: none; }
    .titlecell a:hover { text-decoration: underline; }

    .date { color: var(--muted); font-variant-numeric: tabular-nums; white-space: nowrap; }
    .version { font-variant-numeric: tabular-nums; }

    .badge {
      display: inline-block; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; letter-spacing: .02em;
      border: 1px solid var(--border);
    }
    .st-open { background: color-mix(in oklab, var(--badge-open) 20%, transparent); color: #7a4d00; }
    .st-progress { background: color-mix(in oklab, var(--badge-progress) 20%, transparent); color: #003a7a; }
    .st-done { background: color-mix(in oklab, var(--badge-done) 18%, transparent); color: #064e3b; }
    .st-blocked { background: color-mix(in oklab, var(--badge-blocked) 22%, transparent); color: #6a0f0f; }

    .toolbar { display: flex; gap: 10px; align-items: center; }

    .addform { display: none; margin-top: 14px; gap: 10px; }
    .addform input, .addform select {
      padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--row);
      color: var(--text); min-width: 140px;
    }
    .addform .grow { flex: 1; }

    .empty { text-align: center; padding: 36px; color: var(--muted); }

    .hint { margin-top: 10px; color: var(--muted); font-size: 12px; }
  </style>
</head>
<body>
  <header class="appbar">
    <div class="bar">
      <h1>Worklog <span class="muted">(MySQL‑style table)</span></h1>
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"/></svg>
        <input id="q" type="search" placeholder="Filter tasks… (title, status, version)" />
      </div>
      <div class="toolbar">
        <button id="toggleAdd" class="btn">＋ Add Row</button>
        <button id="exportBtn" class="btn">Export JSON</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <form id="addForm" class="addform" autocomplete="off">
        <input class="grow" id="titleInput" type="text" placeholder="Task Title (shown as a link)" required />
        <input id="urlInput" type="url" placeholder="https://link-to-task-or-doc" />
        <input id="versionInput" type="text" placeholder="Version e.g. 1.0.0" />
        <select id="statusInput">
          <option>Open</option>
          <option>In Progress</option>
          <option>Done</option>
          <option>Blocked</option>
        </select>
        <button class="btn" type="submit">Add</button>
      </form>

      <div class="tablewrap">
        <table id="worklog">
          <thead>
            <tr>
              <th data-key="id">ID</th>
              <th data-key="title">Task Title</th>
              <th data-key="modified">Modified</th>
              <th data-key="version">Version</th>
              <th data-key="status">Status</th>
            </tr>
          </thead>
          <tbody id="rows">
            <!-- rows injected by JS -->
          </tbody>
        </table>
        <div id="emptyState" class="empty" hidden>No matching rows.</div>
      </div>

      <p class="hint">Tip: Click any column header to sort. Use the filter box above to search.</p>
    </div>
  </div>

  <script>
    // --- In‑memory data model ---
    let data = [
      { id: 1, title: "Deploy homepage hero redesign", url: "https://example.com/tasks/1", modified: "2025-08-20T14:12:00Z", version: "1.2.0", status: "In Progress" },
      { id: 2, title: "Fix navbar focus states", url: "https://example.com/tasks/2", modified: "2025-08-18T10:02:00Z", version: "1.1.4", status: "Done" },
      { id: 3, title: "Add Markdown docs for MGU", url: "https://example.com/tasks/3", modified: "2025-08-17T09:30:00Z", version: "1.0.9", status: "Open" },
      { id: 4, title: "Hugo + Eleventy setup guide", url: "https://example.com/tasks/4", modified: "2025-08-21T22:45:00Z", version: "1.3.1", status: "Blocked" }
    ];

    // --- State ---
    let sortKey = 'id';
    let sortDir = 'asc';
    let query = '';

    const rowsEl = document.getElementById('rows');
    const emptyEl = document.getElementById('emptyState');

    function fmtDate(iso) {
      if (!iso) return '';
      try {
        const d = new Date(iso);
        return d.toLocaleString([], { year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' });
      } catch { return iso; }
    }

    function statusClass(s) {
      const k = (s || '').toLowerCase();
      if (k.includes('progress')) return 'badge st-progress';
      if (k.includes('done')) return 'badge st-done';
      if (k.includes('block')) return 'badge st-blocked';
      return 'badge st-open';
    }

    function nextId() {
      return data.length ? Math.max(...data.map(r => r.id)) + 1 : 1;
    }

    function comp(a, b) {
      let va = a[sortKey];
      let vb = b[sortKey];
      if (sortKey === 'modified') { va = new Date(va).getTime(); vb = new Date(vb).getTime(); }
      const dir = sortDir === 'asc' ? 1 : -1;
      if (va < vb) return -1 * dir;
      if (va > vb) return 1 * dir;
      return 0;
    }

    function matches(r) {
      if (!query) return true;
      const q = query.toLowerCase();
      return (
        String(r.id).includes(q) ||
        (r.title && r.title.toLowerCase().includes(q)) ||
        (r.version && r.version.toLowerCase().includes(q)) ||
        (r.status && r.status.toLowerCase().includes(q))
      );
    }

    function render() {
      const filtered = data.filter(matches).sort(comp);
      rowsEl.innerHTML = '';
      filtered.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="idcell">#${r.id}</td>
          <td class="titlecell">${r.url ? `<a href="${r.url}" target="_blank" rel="noopener noreferrer">${r.title}</a>` : r.title}</td>
          <td class="date">${fmtDate(r.modified)}</td>
          <td class="version">${r.version || ''}</td>
          <td><span class="${statusClass(r.status)}">${r.status || 'Open'}</span></td>
        `;
        rowsEl.appendChild(tr);
      });
      emptyEl.hidden = filtered.length !== 0;
    }

    // --- Sorting ---
    document.querySelectorAll('thead th').forEach(th => {
      th.addEventListener('click', () => {
        const key = th.dataset.key;
        if (!key) return;
        if (sortKey === key) {
          sortDir = sortDir === 'asc' ? 'desc' : 'asc';
        } else {
          sortKey = key; sortDir = 'asc';
        }
        render();
      });
    });

    // --- Search ---
    document.getElementById('q').addEventListener('input', (e) => {
      query = e.target.value.trim();
      render();
    });

    // --- Add Row form ---
    const addBtn = document.getElementById('toggleAdd');
    const addForm = document.getElementById('addForm');
    addBtn.addEventListener('click', () => {
      const vis = getComputedStyle(addForm).display !== 'none';
      addForm.style.display = vis ? 'none' : 'flex';
      if (!vis) document.getElementById('titleInput').focus();
    });

    addForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const title = document.getElementById('titleInput').value.trim();
      const url = document.getElementById('urlInput').value.trim();
      const version = document.getElementById('versionInput').value.trim();
      const status = document.getElementById('statusInput').value;
      if (!title) return;
      data.push({ id: nextId(), title, url, version, status, modified: new Date().toISOString() });
      addForm.reset();
      addForm.style.display = 'none';
      render();
    });

    // --- Export JSON ---
    document.getElementById('exportBtn').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'worklog.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    // Initial paint
    render();
  </script>
</body>
</html>
